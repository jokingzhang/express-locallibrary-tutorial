(window.webpackJsonpclient=window.webpackJsonpclient||[]).push([[0],{224:function(e,t,n){e.exports=n(451)},229:function(e,t,n){},231:function(e,t,n){var a={"./All.ts":232,"./Auth.ts":233};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=231},232:function(e,t,n){"use strict";n.r(t),n.d(t,"HOST",function(){return a}),n.d(t,"API",function(){return r});var a=["http://localhost:5001/api","http://api.jokingzhang.com/demo-library/api"],r={home:{getList:"/home"},book:{create:"/book/create",delete:"/book/:id/delete",update:"/book/:id/update",detail:"/book/:id",list:"/books"},author:{create:"/author/create",delete:"/author/:id/delete",update:"/author/:id/update",detail:"/author/:id",list:"/authors"},genre:{create:"/genre/create",delete:"/genre/:id/delete",update:"/genre/:id/update",detail:"/genre/:id",list:"/genres"},bookinstance:{create:"/bookinstance/create",delete:"/bookinstance/:id/delete",update:"/bookinstance/:id/update",detail:"/bookinstance/:id",list:"/bookinstances"}}},233:function(e,t,n){"use strict";n.r(t),n.d(t,"HOST",function(){return a}),n.d(t,"API",function(){return r});var a=["http://localhost:5001/auth","http://api.jokingzhang.com/demo-library/auth"],r={login:"/login"}},254:function(e,t,n){},374:function(e,t,n){},386:function(e,t,n){},450:function(e,t,n){},451:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(8),l=n.n(o),c=n(21),i=n(62),u=(n(229),n(221)),s=n(20),m=n.n(s),f=n(27),d=n(461),p=n(459),b=n(460),h=n(10),g=n(64),E=n(159),y=n.n(E),v=!1,k=n(231),O=k.keys().reduce(function(e,t){return e[y.a.basename(t,y.a.extname(t))]=function(e){var t=v?e.HOST[0]:e.HOST[1];return function e(n){return Object.keys(n).reduce(function(a,r){var o=n[r];return a[r]="string"===typeof o?function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var r=0;return t+o.replace(/:[^\/]+/gi,function(e){var t=n[r++];return void 0===t?e:t})}:e(o),a},{})}(e.API)}(k(t)),e},{});var j=n(35),w=n(36),_=Object(w.a)({forceRefresh:!0});function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach(function(t){Object(j.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var I={isAuthenticated:!1,user:null,token:null},D=localStorage.getItem("token"),C=localStorage.getItem("user");D&&(I.isAuthenticated=!0,I.token=D),C&&(I.user=C);var A=function(e,t){switch(t.type){case"LOGIN":return localStorage.setItem("user",JSON.stringify(t.payload.user)),localStorage.setItem("token",JSON.stringify(t.payload.token)),x({},e,{isAuthenticated:!0,user:t.payload.user,token:t.payload.token});case"LOGOUT":return localStorage.clear(),_.push("/login"),x({},e,{isAuthenticated:!1,user:null});default:return e}},F=r.a.createContext(I),S=n(128),N=n.n(S),Y=n(206),B=n.n(Y),T=N.a;function M(e){return B.a.stringify(e,{arrayFormat:"indices",allowDots:!0})}N.a.interceptors.request.use(function(e){if(e.timeout||(e.timeout=6e4),e.useJson||"post"!==e.method&&"put"!==e.method||(e.headers["Content-Type"]="application/x-www-form-urlencoded",e.transformRequest=M),!e.noToken){var t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),N.a.interceptors.response.use(function(e){var t=e.data;return console.info(e),t&&"object"===typeof t&&"true"===t.success?t:e},function(e){return console.info(e),401===e.response.status&&(localStorage.removeItem("token"),"/login"!==_.location.pathname&&_.push("/login")),e});n(254);var q=p.a.create({name:"login"})(function(e){var t=e.form,n=t.getFieldDecorator,a=t.getFieldsError,o=t.getFieldError,l=t.isFieldTouched,c=r.a.useContext(F).dispatch;var i,u=l("username")&&o("username"),s=l("password")&&o("password");return r.a.createElement("div",{className:"p-login"},r.a.createElement("h1",null," MDN \u672c\u5730\u56fe\u4e66\u9986\u7f51\u7ad9 "),r.a.createElement(p.a,{className:"p-login-form"},r.a.createElement(p.a.Item,{validateStatus:u?"error":"",help:u||""},n("username",{rules:[{required:!0,message:"Please input your username!"}]})(r.a.createElement(b.a,{prefix:r.a.createElement(h.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"}))),r.a.createElement(p.a.Item,{validateStatus:s?"error":"",help:s||""},n("password",{rules:[{required:!0,message:"Please input your Password!"}]})(r.a.createElement(b.a,{prefix:r.a.createElement(h.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password"}))),r.a.createElement(p.a.Item,null,r.a.createElement(g.a,{onClick:function(){e.form.validateFields(function(){var t=Object(f.a)(m.a.mark(function t(n,a){var r;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=13;break}return t.prev=1,t.next=4,T.post(O.Auth.login(),a,{useJson:!0});case 4:r=t.sent,d.a.success("\u767b\u5f55\u6210\u529f"),c({type:"LOGIN",payload:{user:a.username,token:r.data.token}}),e.history.push("/"),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),d.a.error(t.t0.message);case 13:case"end":return t.stop()}},t,null,[[1,10]])}));return function(e,n){return t.apply(this,arguments)}}())},style:{width:"100%"},type:"primary",htmlType:"submit",disabled:(i=a(),Object.keys(i).some(function(e){return i[e]}))},"\u767b\u5f55"))))}),J=n(453),L=function(e){return r.a.createElement("div",null,"NotFound")},R=n(220),z=(n(374),J.a.Content),G=Object(i.g)(function(e){var t=e.routes.find(function(t){return e.location.pathname===t.path}),n=!!t,a=t?t.title:"";return r.a.createElement(z,{className:"c-content"},n&&r.a.createElement(R.a,{className:"c-content-breadcrumb"},r.a.createElement(R.a.Item,null,r.a.createElement(c.c,{to:"/"},"\u9996\u9875")),"/"!==e.location.pathname&&r.a.createElement(R.a.Item,null,r.a.createElement(c.c,{to:e.location.pathname},a))),e.children)}),H=n(86),K=n(126),U=n(218),V=n(222),W=n(211),$=function(){return new Promise(function(e,t){T.get(O.All.home.getList()).then(function(t){e(t.data)}).catch(function(e){d.a.error(e.message),t(e.message)})})},Q=function(e){var t=Object(V.a)($),n=t.loading,a=t.value;t.error;return r.a.createElement("div",null,r.a.createElement("h1",null,"\u56fe\u4e66\u9986\u9996\u9875"),r.a.createElement("p",null,"\u6b22\u8fce\u6765\u5230\u56fe\u4e66\u9986\uff01"),r.a.createElement("h2",null,"\u52a8\u6001\u4fe1\u606f"),r.a.createElement(W.a,{spinning:n},a&&r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("b",null,"\u56fe\u4e66\uff1a"),a.book_count),r.a.createElement("li",null,r.a.createElement("b",null,"\u56fe\u4e66\u5b9e\u4f8b\uff1a"),a.book_instance_count),r.a.createElement("li",null,r.a.createElement("b",null,"\u53ef\u501f\u9605\u56fe\u4e66\u5b9e\u4f8b\uff1a"),a.book_instance_available_count),r.a.createElement("li",null,r.a.createElement("b",null,"\u4f5c\u8005\uff1a"),a.author_count),r.a.createElement("li",null,r.a.createElement("b",null,"\u56fe\u4e66\u5206\u7c7b\uff1a"),a.genre_count))))},X=n(454),Z=n(87),ee=n(456),te=n(212),ne=n(130),ae=n.n(ne);n(386);function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(n,!0).forEach(function(t){Object(j.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var le=ae.a,ce={destroyOnClose:!0,footer:null,maskClosable:!1,closable:!1},ie=(ae.a.open=function(){var e,t,n,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=oe({},ce,{},l);!0===c.footer&&delete c.footer,l.onOk&&(c.onOk=function(e){return l.onOk(e,{close:s,dismiss:m})}),l.onCancel&&(c.onCancel=function(e){return l.onCancel(e,{close:s,dismiss:m})});var i=document.createElement("div");function u(){e||(e=!0,Object(o.unmountComponentAtNode)(i),document.body.removeChild(i))}function s(e){f(!1,function(){return t(e)})}function m(e){f(!1,function(){return n(e)})}function f(e,t){var l,f=c.component,d=Object(te.a)(c,["component"]),p={close:s,dismiss:m};l="function"===typeof f?r.a.createElement(f,null):f,Object(o.render)(r.a.createElement(ae.a,Object.assign({onCancel:m,onOk:s},d,{visible:e,afterClose:function(){t||(t=n),t(),u()}}),a.Children.map(l,function(e){return Object(a.cloneElement)(e,p)})),i)}return document.body.appendChild(i),f(!0),{close:s,dismiss:m,result:new Promise(function(e,a){t=e,n=a})}},n(95)),ue=n(84),se=n(48);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var fe=ie.a.Option,de=new Promise(function(e,t){T.get(O.All.author.list()).then(function(t){var n=t.data.author_list?t.data.author_list.map(function(e){return{label:"".concat(e.family_name,"\uff0c").concat(e.first_name),value:e._id}}):[];e(n)}).catch(function(e){t(e.message)})}),pe=new Promise(function(e,t){T.get(O.All.genre.list()).then(function(t){e(t.data.genre_list||[])}).catch(function(e){t(e.message)})}),be=function(){return Promise.all([de,pe])},he=function(e){return e?new Promise(function(t,n){T.get(O.All.book.detail(e)).then(function(e){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(n,!0).forEach(function(t){Object(j.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e.data.book,{author:e.data.book.author._id,genre:e.data.book.genre.map(function(e){return e._id})});t(n)}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null)},ge=p.a.create({name:"book"})(function(e){var t=Object(V.a)(be),n=Object(V.a)(function(){return he(e.id)}),o=Object(a.useRef)(!1);Object(a.useEffect)(function(){o.current=!0,e.form.setFieldsValue(n.value)},[!o.current,!!n.value]);var l=t.value?t.value[0]:[],c=t.value?t.value[1]:[];return r.a.createElement("div",null,r.a.createElement(W.a,{spinning:t.loading},r.a.createElement(p.a,null,r.a.createElement(p.a.Item,{label:"\u6807\u9898"},e.form.getFieldDecorator("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6807\u9898"}]})(r.a.createElement(b.a,null))),r.a.createElement(p.a.Item,{label:"\u4f5c\u8005"},e.form.getFieldDecorator("author",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u4f5c\u8005"}]})(r.a.createElement(ie.a,{placeholder:"\u8bf7\u9009\u62e9\u4f5c\u8005"},l.map(function(e){return r.a.createElement(fe,{value:e.value},e.label)})))),r.a.createElement(p.a.Item,{label:"\u7b80\u4ecb"},e.form.getFieldDecorator("summary",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7b80\u4ecb"}]})(r.a.createElement(b.a.TextArea,null))),r.a.createElement(p.a.Item,{label:"ISBN"},e.form.getFieldDecorator("isbn",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165ISBN"}]})(r.a.createElement(b.a,null))),r.a.createElement(p.a.Item,{label:"\u5206\u7c7b"},e.form.getFieldDecorator("genre",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5206\u7c7b"}]})(r.a.createElement(ue.a.Group,null,c.map(function(e){return r.a.createElement(ue.a,{value:e._id},e.name)})))),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(se.a,null,r.a.createElement(g.a,{type:"danger",onClick:function(){return e.dismiss()}},"\u53d6\u6d88")),r.a.createElement(se.a,{style:{marginLeft:"12px"}},r.a.createElement(g.a,{type:"primary",onClick:function(){e.form.validateFields(function(){var t=Object(f.a)(m.a.mark(function t(n,a){return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=17;break}if(t.prev=1,!e.id){t.next=8;break}return t.next=5,T.post(O.All.book.update(e.id),a,{useJson:!0});case 5:d.a.success("\u4fee\u6539\u6210\u529f"),t.next=11;break;case 8:return t.next=10,T.post(O.All.book.create(),a,{useJson:!0});case 10:d.a.success("\u6dfb\u52a0\u6210\u529f");case 11:e.close(),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),d.a.error(t.t0.message);case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e,n){return t.apply(this,arguments)}}())}},"\u786e\u8ba4"))))))});function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(n,!0).forEach(function(t){Object(j.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ve=function(){return new Promise(function(e,t){T.get(O.All.book.list()).then(function(t){var n=t.data.book_list&&t.data.book_list.map(function(e){return ye({},e,{authorName:"".concat(e.author.family_name,"\uff0c").concat(e.author.first_name)})});e(n)}).catch(function(e){t(e.message)})})},ke=[{title:"\u4e66\u540d",dataIndex:"title",key:"title"},{title:"\u4f5c\u8005",dataIndex:"authorName",key:"authorName"},{title:"\u64cd\u4f5c",dataIndex:"options",align:"right",key:"options"}],Oe=function(e){var t=Object(X.a)(ve),n=t.loading,a=t.value,o=(t.error,t.retry);var l=function(){var e=Object(f.a)(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.post(O.All.book.delete(t._id),{},{useJson:!0});case 3:d.a.success("\u5220\u9664\u6210\u529f"),o(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d.a.error("\u8bf7\u5148\u5220\u9664\u6240\u6709\u56fe\u4e66\u5b9e\u4f8b");case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("h1",null," \u56fe\u4e66\u5217\u8868 "),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(g.a,{onClick:function(){le.open({component:r.a.createElement(ge,null),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})},type:"primary",style:{marginBottom:16}},"\u6dfb\u52a0\u56fe\u4e66")),r.a.createElement(ee.a,{bordered:!0,rowKey:"_id",columns:ke.map(function(e){return"options"===e.key?ye({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{type:"link",onClick:function(){return function(e){le.open({component:r.a.createElement(ge,{id:e._id}),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})}(t)}},"\u66f4\u65b0"),r.a.createElement(g.a,{type:"link",onClick:function(){return l(t)}},"\u5220\u9664"))}}):"title"===e.key?ye({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(c.b,{to:"/book/".concat(t._id)},e))}}):e}),dataSource:a,loading:n}))},je=n(455),we=n(458),_e=n(462),Pe=function(e){var t=Object(V.a)(function(){return(t=e.match.params.id)?new Promise(function(e,n){T.get(O.All.book.detail(t)).then(function(t){e(t.data)}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null);var t}),n=t.value?t.value.book:null,a=t.value?t.value.book_instances:[];return r.a.createElement("div",null,r.a.createElement(je.a,{onBack:function(){return e.history.goBack()},title:"\u56fe\u4e66\u8be6\u60c5"}),r.a.createElement(we.a,{loading:t.loading},n&&r.a.createElement(_e.a,{column:1,title:n.title},r.a.createElement(_e.a.Item,{label:"\u4f5c\u8005"},"".concat(n.author.family_name,"\uff0c").concat(n.author.first_name)),r.a.createElement(_e.a.Item,{label:"\u7b80\u4ecb"},n.summary),r.a.createElement(_e.a.Item,{label:"ISBN"},n.isbn),r.a.createElement(_e.a.Item,{label:"\u5206\u7c7b"},n.genre&&n.genre.map(function(e){return r.a.createElement(c.b,{to:"/genre/".concat(e._id)},e.name)}))),a.length>0&&r.a.createElement("hr",null),a&&a.map(function(e,t){return r.a.createElement(we.a,{style:{marginTop:20},type:"inner",title:"\u5b9e\u4f8b\uff1a".concat(t+1)},r.a.createElement(_e.a,{column:1},r.a.createElement(_e.a.Item,{label:"\u72b6\u6001"},e.status),r.a.createElement(_e.a.Item,{label:"\u5f52\u8fd8\u65e5\u671f"},e.due_back),r.a.createElement(_e.a.Item,{label:"\u51fa\u7248\u4fe1\u606f"},e.imprint),r.a.createElement(_e.a.Item,{label:"ID"},r.a.createElement(c.b,{to:"/bookinstance/".concat(e._id)}," ",e._id," "))))})))},xe=n(13),Ie=n.n(xe),De=n(457),Ce=p.a.create({name:"author"})(function(e){var t=Object(V.a)(function(){return(t=e.id)?new Promise(function(e,n){T.get(O.All.author.detail(t)).then(function(t){e({first_name:t.data.author.first_name,family_name:t.data.author.family_name,date_of_birth:Ie()(t.data.author.date_of_birth),date_of_death:Ie()(t.data.author.date_of_death)})}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null);var t}),n=Object(a.useRef)(!1);Object(a.useEffect)(function(){n.current=!0,e.form.setFieldsValue(t.value)},[!n.current,!!t.value]);return r.a.createElement("div",null,r.a.createElement(p.a,null,r.a.createElement(p.a.Item,{label:"\u59d3\u7684\u62fc\u97f3"},e.form.getFieldDecorator("first_name",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u59d3\u7684\u62fc\u97f3"}]})(r.a.createElement(b.a,null))),r.a.createElement(p.a.Item,{label:"\u59d3\u7684\u62fc\u97f3"},e.form.getFieldDecorator("family_name",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u59d3\u7684\u62fc\u97f3"}]})(r.a.createElement(b.a,null))),r.a.createElement(p.a.Item,{label:"\u51fa\u751f\u65e5\u671f"},e.form.getFieldDecorator("date_of_birth",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u51fa\u751f\u65e5\u671f"}]})(r.a.createElement(De.a,null))),r.a.createElement(p.a.Item,{label:"\u6b7b\u4ea1\u65e5\u671f"},e.form.getFieldDecorator("date_of_death",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6b7b\u4ea1\u65e5\u671f"}]})(r.a.createElement(De.a,null))),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(se.a,null,r.a.createElement(g.a,{type:"danger",onClick:function(){return e.dismiss()}},"\u53d6\u6d88")),r.a.createElement(se.a,{style:{marginLeft:"12px"}},r.a.createElement(g.a,{type:"primary",onClick:function(){e.form.validateFields(function(){var t=Object(f.a)(m.a.mark(function t(n,a){return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=17;break}if(t.prev=1,!e.id){t.next=8;break}return t.next=5,T.post(O.All.author.update(e.id),a,{useJson:!0});case 5:d.a.success("\u4fee\u6539\u6210\u529f"),t.next=11;break;case 8:return t.next=10,T.post(O.All.author.create(),a,{useJson:!0});case 10:d.a.success("\u6dfb\u52a0\u6210\u529f");case 11:e.close(),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),d.a.error(t.t0.message);case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e,n){return t.apply(this,arguments)}}())}},"\u786e\u8ba4")))))});function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(n,!0).forEach(function(t){Object(j.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Se=function(){return new Promise(function(e,t){T.get(O.All.author.list()).then(function(t){var n=t.data.author_list&&t.data.author_list.map(function(e){return Fe({},e,{authorName:"".concat(e.family_name,"\uff0c").concat(e.first_name),birth:Ie()(e.date_of_birth).format("YYYY-MM-DD"),death:Ie()(e.date_of_death).format("YYYY-MM-DD")})});e(n)}).catch(function(e){t(e.message)})})},Ne=[{title:"\u4f5c\u8005\u540d\u79f0",dataIndex:"authorName",key:"authorName"},{title:"\u51fa\u751f\u65e5\u671f",dataIndex:"birth",key:"birth"},{title:"\u6b7b\u4ea1\u65e5\u671f",dataIndex:"death",key:"death"},{title:"\u64cd\u4f5c",dataIndex:"options",align:"right",key:"options"}],Ye=function(e){var t=Object(X.a)(Se),n=t.loading,a=t.value,o=(t.error,t.retry);var l=function(){var e=Object(f.a)(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.post(O.All.author.delete(t._id),{},{useJson:!0});case 3:d.a.success("\u5220\u9664\u6210\u529f"),o(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d.a.error("\u8bf7\u5148\u5220\u9664\u6240\u6709\u4f5c\u8005\u6709\u5173\u7684\u4e66\u7c4d");case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("h1",null," \u4f5c\u8005\u5217\u8868 "),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(g.a,{onClick:function(){le.open({component:r.a.createElement(Ce,null),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})},type:"primary",style:{marginBottom:16}},"\u6dfb\u52a0\u4f5c\u8005")),r.a.createElement(ee.a,{bordered:!0,rowKey:"_id",columns:Ne.map(function(e){return"options"===e.key?Fe({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{type:"link",onClick:function(){return function(e){le.open({component:r.a.createElement(Ce,{id:e._id}),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})}(t)}},"\u66f4\u65b0"),r.a.createElement(g.a,{type:"link",onClick:function(){return l(t)}},"\u5220\u9664"))}}):"authorName"===e.key?Fe({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(c.b,{to:"/author/".concat(t._id)},e))}}):e}),dataSource:a,loading:n}))},Be=function(e){var t=Object(V.a)(function(){return(t=e.match.params.id)?new Promise(function(e,n){T.get(O.All.author.detail(t)).then(function(t){e(t.data)}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null);var t}),n=t.value?t.value.author:null,a=t.value?t.value.author_books:[];return r.a.createElement("div",null,r.a.createElement(je.a,{onBack:function(){return e.history.goBack()},title:"\u4f5c\u8005\u8be6\u60c5"}),r.a.createElement(we.a,{loading:t.loading},n&&r.a.createElement(_e.a,{column:1,title:a.title},r.a.createElement(_e.a.Item,{label:"\u59d3\u540d"},"".concat(n.family_name,"\uff0c").concat(n.first_name)),r.a.createElement(_e.a.Item,{label:"\u51fa\u751f\u65e5\u671f"},Ie()(n.date_of_birth).format("YYYY-MM-DD")),r.a.createElement(_e.a.Item,{label:"\u6b7b\u4ea1\u65e5\u671f"},Ie()(n.date_of_death).format("YYYY-MM-DD"))),r.a.createElement("hr",null),a&&a.map(function(e,t){return r.a.createElement(we.a,{style:{marginTop:20},type:"inner",title:"\u56fe\u4e66\uff1a".concat(t+1)},r.a.createElement(_e.a,{column:1},r.a.createElement(_e.a.Item,{label:"\u6807\u9898"},r.a.createElement(c.b,{to:"/book/".concat(e._id)},e.title)),r.a.createElement(_e.a.Item,{label:"\u7b80\u4ecb"},e.summary)))}),0===a.length&&r.a.createElement("div",null,"\u6682\u65e0\u56fe\u4e66")))},Te=p.a.create({name:"genre"})(function(e){var t=Object(V.a)(function(){return(t=e.id)?new Promise(function(e,n){T.get(O.All.genre.detail(t)).then(function(t){e({name:t.data.genre.name})}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null);var t}),n=Object(a.useRef)(!1);Object(a.useEffect)(function(){n.current=!0,e.form.setFieldsValue(t.value)},[!n.current,!!t.value]);return r.a.createElement("div",null,r.a.createElement(p.a,null,r.a.createElement(p.a.Item,{label:"\u5206\u7c7b\u540d\u79f0"},e.form.getFieldDecorator("name",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5206\u7c7b\u540d\u79f0"}]})(r.a.createElement(b.a,null))),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(se.a,null,r.a.createElement(g.a,{type:"danger",onClick:function(){return e.dismiss()}},"\u53d6\u6d88")),r.a.createElement(se.a,{style:{marginLeft:"12px"}},r.a.createElement(g.a,{type:"primary",onClick:function(){e.form.validateFields(function(){var t=Object(f.a)(m.a.mark(function t(n,a){return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=17;break}if(t.prev=1,!e.id){t.next=8;break}return t.next=5,T.post(O.All.genre.update(e.id),a,{useJson:!0});case 5:d.a.success("\u4fee\u6539\u6210\u529f"),t.next=11;break;case 8:return t.next=10,T.post(O.All.genre.create(),a,{useJson:!0});case 10:d.a.success("\u6dfb\u52a0\u6210\u529f");case 11:e.close(),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),d.a.error(t.t0.message);case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e,n){return t.apply(this,arguments)}}())}},"\u786e\u8ba4")))))});function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(n,!0).forEach(function(t){Object(j.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Je=function(){return new Promise(function(e,t){T.get(O.All.genre.list()).then(function(t){e(t.data.genre_list||[])}).catch(function(e){t(e.message)})})},Le=[{title:"\u5206\u7c7b\u540d\u79f0",dataIndex:"name",key:"name"},{title:"\u64cd\u4f5c",dataIndex:"options",align:"right",key:"options"}],Re=function(e){var t=Object(X.a)(Je),n=t.loading,a=t.value,o=(t.error,t.retry);var l=function(){var e=Object(f.a)(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.post(O.All.genre.delete(t._id),{},{useJson:!0});case 3:d.a.success("\u5220\u9664\u6210\u529f"),o(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d.a.error("\u8bf7\u5148\u5220\u9664\u6240\u6709\u5206\u7c7b\u76f8\u5173\u7684\u4e66\u7c4d");case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("h1",null," \u5206\u7c7b\u5217\u8868 "),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(g.a,{onClick:function(){le.open({component:r.a.createElement(Te,null),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})},type:"primary",style:{marginBottom:16}},"\u6dfb\u52a0\u5206\u7c7b")),r.a.createElement(ee.a,{bordered:!0,rowKey:"_id",columns:Le.map(function(e){return"options"===e.key?qe({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{type:"link",onClick:function(){return function(e){le.open({component:r.a.createElement(Te,{id:e._id}),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})}(t)}},"\u66f4\u65b0"),r.a.createElement(g.a,{type:"link",onClick:function(){return l(t)}},"\u5220\u9664"))}}):"name"===e.key?qe({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(c.b,{to:"/genre/".concat(t._id)},e))}}):e}),dataSource:a,loading:n}))},ze=function(e){var t=Object(V.a)(function(){return(t=e.match.params.id)?new Promise(function(e,n){T.get(O.All.genre.detail(t)).then(function(t){e(t.data)}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null);var t}),n=t.value?t.value.genre:{},a=t.value?t.value.genre_books:[];return r.a.createElement("div",null,r.a.createElement(je.a,{onBack:function(){return e.history.goBack()},title:"\u5206\u7c7b\u8be6\u60c5"}),r.a.createElement(W.a,{spinning:t.loading},r.a.createElement("h1",null,"\u5206\u7c7b\u540d\u79f0\uff1a",n.name),a&&a.map(function(e,t){return r.a.createElement(we.a,{style:{marginTop:20},type:"inner",title:"\u56fe\u4e66\uff1a".concat(t+1)},r.a.createElement(_e.a,{column:1},r.a.createElement(_e.a.Item,{label:"\u6807\u9898"},r.a.createElement(c.b,{to:"/book/".concat(e._id)},e.title)),r.a.createElement(_e.a.Item,{label:"\u7b80\u4ecb"},e.summary)))}),0===a.length&&r.a.createElement("div",null,"\u6682\u65e0\u56fe\u4e66")))},Ge=ie.a.Option,He=[{label:"\u53ef\u4f9b\u501f\u9605",value:"\u53ef\u4f9b\u501f\u9605"},{label:"\u5df2\u501f\u51fa",value:"\u5df2\u501f\u51fa"},{label:"\u9986\u85cf\u7ef4\u62a4",value:"\u9986\u85cf\u7ef4\u62a4"}],Ke=function(){return new Promise(function(e,t){T.get(O.All.book.list()).then(function(t){var n=t.data.book_list.map(function(e){return{label:e.title,value:e._id}});e(n)}).catch(function(e){d.a.error(e.message),t(e.message)})})},Ue=p.a.create({name:"bookinstance"})(function(e){var t=Object(V.a)(Ke),n=Object(V.a)(function(){return(t=e.id)?new Promise(function(e,n){T.get(O.All.bookinstance.detail(t)).then(function(t){var n={book:t.data.bookinstance.book._id,imprint:t.data.bookinstance.imprint,status:t.data.bookinstance.status,due_back:Ie()(t.data.bookinstance.due_back)};e(n)}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null);var t}),o=Object(a.useRef)(!1);Object(a.useEffect)(function(){o.current=!0,e.form.setFieldsValue(n.value)},[!o.current,!!n.value]);var l=t.value||[];return r.a.createElement("div",null,r.a.createElement(W.a,{spinning:t.loading},r.a.createElement(p.a,null,r.a.createElement(p.a.Item,{label:"\u56fe\u4e66\u540d\u79f0"},e.form.getFieldDecorator("book",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u56fe\u4e66\u540d\u79f0"}]})(r.a.createElement(ie.a,{placeholder:"\u8bf7\u9009\u62e9\u56fe\u4e66\u540d\u79f0"},l.map(function(e){return r.a.createElement(Ge,{value:e.value},e.label)})))),r.a.createElement(p.a.Item,{label:"\u51fa\u7248\u4fe1\u606f"},e.form.getFieldDecorator("imprint",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u51fa\u7248\u4fe1\u606f"}]})(r.a.createElement(b.a,null))),r.a.createElement(p.a.Item,{label:"\u56fe\u4e66\u53ef\u501f\u65e5\u671f"},e.form.getFieldDecorator("due_back",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u56fe\u4e66\u53ef\u501f\u65e5\u671f"}]})(r.a.createElement(De.a,null))),r.a.createElement(p.a.Item,{label:"\u501f\u9605\u72b6\u6001"},e.form.getFieldDecorator("status",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u501f\u9605\u72b6\u6001"}]})(r.a.createElement(ie.a,{placeholder:"\u8bf7\u9009\u62e9\u72b6\u6001"},He.map(function(e){return r.a.createElement(Ge,{key:e.value,value:e.value},e.label)})))),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(se.a,null,r.a.createElement(g.a,{type:"danger",onClick:function(){return e.dismiss()}},"\u53d6\u6d88")),r.a.createElement(se.a,{style:{marginLeft:"12px"}},r.a.createElement(g.a,{type:"primary",onClick:function(){e.form.validateFields(function(){var t=Object(f.a)(m.a.mark(function t(n,a){return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=17;break}if(t.prev=1,!e.id){t.next=8;break}return t.next=5,T.post(O.All.bookinstance.update(e.id),a,{useJson:!0});case 5:d.a.success("\u4fee\u6539\u6210\u529f"),t.next=11;break;case 8:return t.next=10,T.post(O.All.bookinstance.create(),a,{useJson:!0});case 10:d.a.success("\u6dfb\u52a0\u6210\u529f");case 11:e.close(),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),d.a.error(t.t0.message);case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e,n){return t.apply(this,arguments)}}())}},"\u786e\u8ba4"))))))});function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(n,!0).forEach(function(t){Object(j.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $e=function(){return new Promise(function(e,t){T.get(O.All.bookinstance.list()).then(function(t){var n=t.data.bookinstance_list.map(function(e){return We({},e,{dueBack:Ie()(e.due_back).format("YYYY-MM-DD"),bookTitle:"".concat(e.book.title,"\uff1a").concat(e.imprint)})});e(n)}).catch(function(e){t(e.message)})})},Qe=[{title:"\u4e66\u7c4d\u540d\u79f0",dataIndex:"bookTitle",key:"bookTitle"},{title:"\u501f\u9605\u72b6\u6001",dataIndex:"status",key:"status"},{title:"\u5f52\u8fd8\u65e5\u671f",dataIndex:"dueBack",key:"dueBack"},{title:"\u64cd\u4f5c",dataIndex:"options",align:"right",key:"options"}],Xe=[{key:"home",title:"\u9996\u9875",exact:!0,component:Q,inMenu:!0,path:"/"},{key:"book",title:"\u4e66\u7c4d",path:"/book",exact:!0,component:Oe,inMenu:!0},{key:"book-detail",title:"\u4e66\u7c4d\u8be6\u60c5",path:"/book/:id",component:Pe},{key:"author",title:"\u4f5c\u8005",path:"/author",exact:!0,component:Ye,inMenu:!0},{key:"author-detail",title:"\u4f5c\u8005\u8be6\u60c5",path:"/author/:id",component:Be},{key:"genre",title:"\u5206\u7c7b",path:"/genre",exact:!0,component:Re,inMenu:!0},{key:"genre-detail",title:"\u5206\u7c7b\u8be6\u60c5",path:"/genre/:id",component:ze},{key:"bookinstance",title:"\u4e66\u7c4d\u5b9e\u4f8b",path:"/bookinstance",exact:!0,component:function(e){var t=Object(X.a)($e),n=t.loading,a=t.value,o=(t.error,t.retry);var l=function(){var e=Object(f.a)(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.post(O.All.author.delete(t._id),{},{useJson:!0});case 3:d.a.success("\u5220\u9664\u6210\u529f"),o(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),d.a.error("\u8bf7\u5148\u5220\u9664\u6240\u6709\u4f5c\u8005\u6709\u5173\u7684\u4e66\u7c4d");case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("h1",null," \u5b9e\u4f8b\u5217\u8868 "),r.a.createElement(Z.a,{type:"flex",justify:"end"},r.a.createElement(g.a,{onClick:function(){le.open({component:r.a.createElement(Ue,null),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})},type:"primary",style:{marginBottom:16}},"\u6dfb\u52a0\u5b9e\u4f8b")),r.a.createElement(ee.a,{bordered:!0,rowKey:"_id",columns:Qe.map(function(e){return"options"===e.key?We({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{type:"link",onClick:function(){return function(e){le.open({component:r.a.createElement(Ue,{id:e._id}),width:900,maskClosable:!1,footer:null}).result.then(function(){o()})}(t)}},"\u66f4\u65b0"),r.a.createElement(g.a,{type:"link",onClick:function(){return l(t)}},"\u5220\u9664"))}}):"bookTitle"===e.key?We({},e,{render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(c.b,{to:"/bookinstance/".concat(t._id)},e))}}):e}),dataSource:a,loading:n}))},inMenu:!0},{key:"bookinstance-detail",title:"\u4e66\u7c4d\u5b9e\u4f8b\u8be6\u60c5",path:"/bookinstance/:id",component:function(e){var t=Object(V.a)(function(){return(t=e.match.params.id)?new Promise(function(e,n){T.get(O.All.bookinstance.detail(t)).then(function(t){e(t.data.bookinstance)}).catch(function(e){d.a.error(e.message),n(e.message)})}):Promise.resolve(null);var t});return console.info(t.value),r.a.createElement("div",null,r.a.createElement(je.a,{onBack:function(){return e.history.goBack()},title:"\u5b9e\u4f8b\u8be6\u60c5"}),r.a.createElement(we.a,{loading:t.loading},t.value&&r.a.createElement(_e.a,{column:1},r.a.createElement(_e.a.Item,{label:"ID"},t.value._id),r.a.createElement(_e.a.Item,{label:"\u6807\u9898"},r.a.createElement(c.b,{to:"/book/".concat(t.value.book._id)},t.value.book.title)),r.a.createElement(_e.a.Item,{label:"\u51fa\u7248\u4fe1\u606f"},t.value.imprint),r.a.createElement(_e.a.Item,{label:"\u72b6\u6001"},t.value.status),r.a.createElement(_e.a.Item,{label:"\u53ef\u501f\u65e5\u671f"},Ie()(t.value.due_back).format("YYYY-MM-DD")))))}}],Ze=J.a.Header,et=(J.a.Footer,Object(i.g)(function(e){var t=r.a.useContext(F),n=t.state,a=t.dispatch;return r.a.createElement(Ze,{className:"l-header"},r.a.createElement(H.a,{className:"l-menu",theme:"dark",mode:"horizontal",selectedKeys:[e.location.pathname]},Xe.filter(function(e){return e.inMenu}).map(function(e){return r.a.createElement(H.a.Item,{key:e.path},r.a.createElement(c.c,{to:e.path},e.title))}),r.a.createElement(K.a,{overlay:r.a.createElement(H.a,null,r.a.createElement(H.a.Item,null,r.a.createElement("a",{onClick:function(){a({type:"LOGOUT"})}},"\u767b\u51fa")))},r.a.createElement("a",{className:"ant-dropdown-link",href:"#"},r.a.createElement(U.a,{icon:"user"})," ",n.user||"admin"))))})),tt=(n(450),J.a.Footer),nt=Object(i.g)(function(e){return Object(a.useEffect)(function(){document.title="Express Locallibrary Tutorial Demo"},[]),r.a.createElement("div",{className:"App"},r.a.createElement(J.a,null,r.a.createElement(et,null),r.a.createElement(G,{routes:Xe},r.a.createElement(i.d,null,Xe.map(function(e){return r.a.createElement(i.b,{exact:!!e.exact,component:e.component,path:e.path})}),r.a.createElement(i.b,{component:L}))),r.a.createElement(tt,{className:"l-footer"},"Express Locallibrary Tutorial Demo \xa92019 Created by zhangbx")))}),at=function(e){var t=Object(a.useReducer)(A,I),n=Object(u.a)(t,2),o=n[0],l=n[1];return o.token?r.a.createElement(F.Provider,{value:{state:o,dispatch:l}},r.a.createElement(i.b,{component:nt})):r.a.createElement(F.Provider,{value:{state:o,dispatch:l}},r.a.createElement(i.d,null,r.a.createElement(i.b,{path:"/login",component:q}),r.a.createElement(i.a,{to:"/login"})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(c.a,null,r.a.createElement(i.b,{component:at})),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[224,1,2]]]);
//# sourceMappingURL=main.5aa1ca04.chunk.js.map